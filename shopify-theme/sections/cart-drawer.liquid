{% comment %}
  Cart Drawer Section
{% endcomment %}

<cart-drawer class="cart-drawer" id="CartDrawer">
  <div class="cart-drawer__header">
    <h2 class="cart-drawer__title">
      {{ section.settings.heading | default: 'üõçÔ∏è Your Cart' }}
    </h2>
    <button 
      class="cart-drawer__close"
      type="button"
      onclick="this.closest('cart-drawer').close()"
      aria-label="{{ 'accessibility.close' | t | default: 'Close' }}"
    >
      <svg class="icon icon-close" aria-hidden="true" focusable="false">
        <path d="m19 6.41l-1.41-1.41L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41z"/>
      </svg>
    </button>
  </div>

  <cart-drawer-items class="cart-drawer__items">
    {%- if cart == empty -%}
      <div class="cart-drawer__empty">
        <div class="empty-state">
          <div class="empty-state__icon">üêï</div>
          <h3>{{ section.settings.empty_heading | default: 'Your cart is empty' }}</h3>
          <p>{{ section.settings.empty_text | default: 'Start shopping for your pup!' }}</p>
          <a href="{{ routes.all_products_collection_url }}" class="btn" onclick="this.closest('cart-drawer').close()">
            {{ section.settings.continue_shopping | default: 'Continue Shopping' }}
          </a>
        </div>
      </div>
    {%- else -%}
      <div class="cart-items" id="CartDrawer-CartItems">
        {%- for item in cart.items -%}
          <div class="cart-item" id="CartDrawer-Item-{{ item.index | plus: 1 }}" data-cart-item data-index="{{ item.index | plus: 1 }}">
            <div class="cart-item__image">
              {%- if item.image -%}
                {{ item.image | image_url: width: 150 | image_tag: 
                  class: 'cart-item__image',
                  alt: item.image.alt | escape,
                  loading: 'lazy'
                }}
              {%- endif -%}
            </div>

            <div class="cart-item__details">
              <h3 class="cart-item__title">
                <a href="{{ item.product.url }}">{{ item.product.title }}</a>
              </h3>
              
              {%- if item.product.has_only_default_variant == false or item.properties.size != 0 or item.selling_plan_allocation != nil -%}
                <dl class="cart-item__details-list">
                  {%- if item.product.has_only_default_variant == false -%}
                    {%- for option in item.options_with_values -%}
                      <div class="cart-item__option">
                        <dt>{{ option.name }}:</dt>
                        <dd>{{ option.value }}</dd>
                      </div>
                    {%- endfor -%}
                  {%- endif -%}

                  {%- for property in item.properties -%}
                    {%- assign property_first_char = property.first | slice: 0 -%}
                    {%- if property.last != blank and property_first_char != '_' -%}
                      <div class="cart-item__option">
                        <dt>{{ property.first }}:</dt>
                        <dd>
                          {%- if property.last contains '/uploads/' -%}
                            <a href="{{ property.last }}" class="link" target="_blank">
                              {{ property.last | split: '/' | last }}
                            </a>
                          {%- else -%}
                            {{ property.last }}
                          {%- endif -%}
                        </dd>
                      </div>
                    {%- endif -%}
                  {%- endfor -%}
                </dl>
              {%- endif -%}

              <div class="cart-item__price">
                {%- if item.original_price != item.final_price -%}
                  <span class="price price--on-sale">
                    <span class="price__sale">{{ item.final_price | money }}</span>
                    <span class="price__compare">{{ item.original_price | money }}</span>
                  </span>
                {%- else -%}
                  <span class="price">{{ item.original_price | money }}</span>
                {%- endif -%}
              </div>

              <div class="cart-item__quantity">
                <div class="quantity-selector">
                  <button 
                    class="quantity-selector__button" 
                    name="minus" 
                    type="button"
                    onclick="this.closest('cart-drawer').updateQuantity({{ item.index | plus: 1 }}, {{ item.quantity | minus: 1 }})"
                  >
                    <span class="visually-hidden">{{ 'products.product.quantity.decrease' | t: product: item.product.title | escape }}</span>
                    <svg aria-hidden="true" focusable="false" class="icon icon-minus">
                      <path d="M10 2v3H7v5h3v3h5v-3h3V5h-3V2h-5z"/>
                    </svg>
                  </button>

                  <input 
                    class="quantity-selector__current" 
                    type="number" 
                    value="{{ item.quantity }}"
                    min="0" 
                    aria-label="{{ 'products.product.quantity.input_label' | t: product: item.product.title | escape }}"
                    id="Drawer-quantity-{{ item.index | plus: 1 }}"
                    data-index="{{ item.index | plus: 1 }}"
                  >

                  <button 
                    class="quantity-selector__button" 
                    name="plus" 
                    type="button"
                    onclick="this.closest('cart-drawer').updateQuantity({{ item.index | plus: 1 }}, {{ item.quantity | plus: 1 }})"
                  >
                    <span class="visually-hidden">{{ 'products.product.quantity.increase' | t: product: item.product.title | escape }}</span>
                    <svg aria-hidden="true" focusable="false" class="icon icon-plus">
                      <path d="M10 2v3h3v5h-3v3H5v-3H2V5h3V2h5z"/>
                    </svg>
                  </button>
                </div>
              </div>

              <cart-remove-button 
                id="CartDrawer-Remove-{{ item.index | plus: 1 }}" 
                data-index="{{ item.index | plus: 1 }}"
              >
                <button 
                  class="cart-item__remove" 
                  type="button"
                  aria-label="{{ 'sections.cart.remove_title' | t: title: item.title }}"
                >
                  {{ section.settings.remove_button_text | default: 'üóëÔ∏è Remove' }}
                </button>
              </cart-remove-button>
            </div>
          </div>
        {%- endfor -%}
      </div>
    {%- endif -%}
  </cart-drawer-items>

  {%- if cart != empty -%}
    <div class="cart-drawer__footer" id="CartDrawer-Footer">
      {%- if settings.show_cart_note -%}
        <div class="cart-note">
          <label for="CartDrawer-Note" class="cart-note__label">
            {{ 'sections.cart.note' | t | default: 'Order special instructions' }}
          </label>
          <textarea
            class="cart-note__input"
            name="note"
            form="CartDrawer-Form"
            id="CartDrawer-Note"
            placeholder="{{ 'sections.cart.note' | t | default: 'Order special instructions' }}"
          >{{ cart.note }}</textarea>
        </div>
      {%- endif -%}

      <div class="cart-drawer__total">
        <div class="cart-drawer__total-label">
          {{ 'sections.cart.subtotal' | t | default: 'Subtotal' }}
        </div>
        <div class="cart-drawer__total-price">
          {{ cart.total_price | money }}
        </div>
      </div>

      {%- if cart.cart_level_discount_applications.size > 0 -%}
        <div class="cart-drawer__discounts">
          {%- for discount in cart.cart_level_discount_applications -%}
            <div class="cart-drawer__discount">
              <span class="cart-drawer__discount-title">{{ discount.title }}</span>
              <span class="cart-drawer__discount-amount">-{{ discount.total_allocated_amount | money }}</span>
            </div>
          {%- endfor -%}
        </div>
      {%- endif -%}

      <small class="cart-drawer__taxes">
        {%- if cart.taxes_included and shop.shipping_policy.body != blank -%}
          {{ 'sections.cart.taxes_included_and_shipping_policy_html' | t: link: shop.shipping_policy.url }}
        {%- elsif cart.taxes_included -%}
          {{ 'sections.cart.taxes_included_but_shipping_at_checkout' | t }}
        {%- elsif shop.shipping_policy.body != blank -%}
          {{ 'sections.cart.taxes_and_shipping_policy_at_checkout_html' | t: link: shop.shipping_policy.url }}
        {%- else -%}
          {{ 'sections.cart.taxes_and_shipping_at_checkout' | t }}
        {%- endif -%}
      </small>

      <div class="cart-drawer__actions">
        <a href="{{ routes.cart_url }}" class="btn btn--secondary cart-drawer__view-cart">
          {{ 'sections.cart.view_cart' | t | default: 'View Cart' }}
        </a>
        
        <button 
          type="submit" 
          id="CartDrawer-Checkout" 
          class="btn cart-drawer__checkout" 
          name="add" 
          form="CartDrawer-Form"
          formaction="{{ routes.cart_url }}"
        >
          {{ section.settings.checkout_button_text | default: 'üöÄ Checkout' }}
        </button>
      </div>
    </div>

    <form action="{{ routes.cart_url }}" method="post" id="CartDrawer-Form" novalidate class="cart-form">
      <div id="CartDrawer-LiveRegionText" class="sr-only" aria-live="polite" role="status"></div>
      <div id="CartDrawer-LineItemStatus" class="visually-hidden" aria-live="polite" aria-hidden="true" role="status">
        {{ 'accessibility.loading' | t }}
      </div>
    </form>
  {%- endif -%}
</cart-drawer>

<div class="cart-overlay" onclick="document.getElementById('CartDrawer').close()"></div>

{% schema %}
{
  "name": "Cart drawer",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "default": "üõçÔ∏è Your Cart",
      "label": "Heading"
    },
    {
      "type": "text",
      "id": "empty_heading",
      "default": "Your cart is empty",
      "label": "Empty cart heading"
    },
    {
      "type": "text",
      "id": "empty_text",
      "default": "Start shopping for your pup!",
      "label": "Empty cart text"
    },
    {
      "type": "text",
      "id": "continue_shopping",
      "default": "Continue Shopping",
      "label": "Continue shopping button text"
    },
    {
      "type": "text",
      "id": "remove_button_text",
      "default": "üóëÔ∏è Remove",
      "label": "Remove button text"
    },
    {
      "type": "text",
      "id": "checkout_button_text",
      "default": "üöÄ Checkout",
      "label": "Checkout button text"
    }
  ]
}
{% endschema %}